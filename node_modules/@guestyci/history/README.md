# Platform-libs-history

**A Guesty thin navigation wrapper over history(react-router)**

Live examples available in [livebook](livebook.guesty.com/history)

## Purpose

Guesty's [`Layout Page`](https://github.com/guestyorg/layout-page/) presents all the applications inside an `Iframe`.
Hence, in order to provide the user with a coherent navigation experience, me must coordinate in-app navigations with the `Layout Page`.  
Using this module will automatically do so for you.  
More specifically, the `Layout Page` will recieve a message to align its URL when the following happens:

- A navigation `Push` or `Replace` action is being taken.
- The `Layout Page` and the app doesn't not share the same URL _path_ (excluding the `apps/` prefix);

## requirements

`react-router` or `react-router-dom`

\*\* if you're using a guesty generated project, react router will be auto added to your project

## Installation

npm:

```bash
    npm install @guestyci/history
```

yarn:

```bash
    yarn add @guestyci/history
```

## initializing

To allow our utility to access your apps history, the simplest way is to set it as your history

```javascript
import React from 'react';
import ReactDOM from 'react-dom';
import { Router } from 'react-router-dom';
import createHistory from '@guestyci/history/createHistory';
import App from './App';

  const api = new Resource();
  const history = createHistory({baseUrl: '<baseUrl>', alias: '<alias>'})

  ReactDOM.render(
      <Router history={history}>
         <App />
      </Router>
    document.getElementById('root'),
  );
```

This will set our history object as your default router history and will allow you to navigate and route via our utility

- `<baseUrl>`: If all the URLs in your app are relative to some other "base" URL, use the baseUrl option. This option transparently adds the given string to the front of all URLs you use.
- `<alias>`: If your app and its parent doesn't share the same "base" url (excluding the `apps/` prefix), set the `alias` options with the parent "base" URL. Otherwise, the app "base" URL will override it.
- Make sure you import `Router` and not `BrowserRouter` so we will be able to inject our history object.

#### Examples

| `Layout Page` URL              | App URL                                | `baseUrl`        | `alias`  |
| ------------------------------ | -------------------------------------- | ---------------- | -------- |
| `https://app.guesty.com/inbox` | `https://app.guesty.com/apps/inbox`    | `/apps/inbox`    |
| `https://app.guesty.com/inbox` | `https://app.guesty.com/apps/inbox-v2` | `/apps/inbox-v2` | `/inbox` |

## Usage

#### Updating initial route - DEPRECATED

As stated before, createHistory will manage everything for you.  
But in some cases you have no need for routing and only want to update the dashboard url.  
For that you can use our `init` method.

inside root `index.js`

```javascript
import { init } from '@guestyci/history';

init('<path_to_change>');
//rest of code
```

This will post message to the parent url your route.

### Navigating

**Using history will allow you to also use the pure react router basic funcationality**

In case you choose to navigate with our utility:

To navigate between flows use the `go` or `push` methods

```javascript
import navigationUtils from '@guestyci/history/utils';

function goToHome() {
  // this will redirect to '<baseUrl>/home'
  navigationUtils.go('home');
}
```

To navigate with query params, you can use the more robust option `push`

To replace the current state use `replace`

```javascript
import navigationUtils from '@guestyci/history/utils';

function goToHome() {
  // this will redirect to '<baseUrl>/home'
  navigationUtils.replace('home');
}
```

```javascript
import navigationUtils from '@guestyci/history/utils';

function goToHome(params = {}) {
  // this will redirect to '<baseUrl>/home' and will prepare your params to urlparams
  navigationUtils.push({ pathname: 'home', search: params });
}
```

You can also use go with a second param

```javascript
import navigationUtils from '@guestyci/history/utils';

function goToHome(params = {}) {
  // this will redirect to '<baseUrl>/home' and will prepare your params to urlparams
  navigationUtils.go('home', params);
}
```

To push query params to url, you can use the `push` method as seen (only pass search) or use the `setQueryParams` method

```javascript
import navigationUtils from '@guestyci/history/utils';

function goToHome(params = {}) {
  // this will redirect to '<baseUrl>/home?<your params>' and will prepare your params to urlparams
  navigationUtils.push({ search: params });
  // this will redirect to '<baseUrl>/home?<your params>' and will prepare your params to urlparams
  navigationUtils.setQueryParams(params);
}
```

To get the query params (as an object) use `getQueryParams`:

```javascript
import navigationUtils from '@guestyci/history/utils';

function doSomething() {
  const params = navigationUtils.getQueryParams();

  console.log('params', params);
}
```

To get the current url path (relative) use `getPathName`:

```javascript
import navigationUtils from '@guestyci/history/utils';

function doSomething() {
  const activePath = navigationUtils.getPathName();

  console.log('activePath', activePath);
}
```

You can also check if a path has an attribute such as id or so with `hasInPath`:

```javascript
function doSomething() {
  const inPath = navigationUtils.hasInPath(id);
  if (!inPath) {
    // do something
  }
}
```

Or just access the location object directly via `history.location`

#### Components

`NavTabs` are available for tab navigation

```javascript
import React from 'react';
import { Tabs, Tab } from '@guestyci/history/NavTabs';

const initialItems = [
  {
    title: 'Reservation',
    to: '/reservation',
  },
  {
    title: 'Listing',
    to: '/listing',
  },
  {
    title: 'Inbox',
    to: '/inbox',
  },
];

const TabsExample = () => {
  return (
    <Tabs>
      {items.map((item) => (
        <Tab to={item.to} key={item.to}>
          {item.title}
        </Tab>
      ))}
    </Tabs>
  );
};

export default TabsExample;
```

`Link` component to navigate in your app or between apps

```javascript
import React from 'react';
import Link from '@guestyci/history/Link';

const LinkExample = () => {
  return (
    <>
      <Link to="/listing/123">Listing 123</Link>
      <Link href="/reservation/123">Different app page</Link>
    </>
  );
};

export default LinkExample;
```

### Additional methods

- listen - { fn } - Listener to route changes
- goBack - browser back
- goForward - browser forward
- link - { url, isNewWindow = true } change the window location
- length - { fn } get the stack size of the history object
  you can check the implementation according to our source code
- stringifyQueryParams - { fn } - returns the string query params out of an object

## Changelog

For updates please refer to our [changelog](https://github.com/guestyorg/history/blob/master/CHANGELOG.md)
