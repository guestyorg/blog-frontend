import React, { useRef, useCallback } from 'react';
import PropTypes from 'prop-types';
import { FormProvider } from "../../enums";
import FormContext from "./FormContext";

var scrollToElement = function scrollToElement(element, offSet) {
  var position = element.getBoundingClientRect().top + document.documentElement.scrollTop;
  element.focus({
    preventScroll: true
  });
  window.scrollTo({
    top: position - offSet,
    behavior: 'smooth'
  });
};

export var scrollToFirstError = function scrollToFirstError(formRef, offSet) {
  var el = formRef && formRef.current && formRef.current.querySelector('.invalid-field');

  if (el) {
    scrollToElement(el, offSet);
  }
};

var Form = function Form(_ref) {
  var onSubmit = _ref.onSubmit,
      children = _ref.children,
      scrollOffset = _ref.scrollOffset,
      className = _ref.className,
      style = _ref.style,
      provider = _ref.provider,
      fieldInstance = _ref.fieldInstance;
  var formRef = useRef(null);
  var handleSubmit = useCallback(function (e) {
    e.preventDefault();
    onSubmit();
    scrollToFirstError(formRef, scrollOffset);
  }, [formRef]);
  return /*#__PURE__*/React.createElement("form", {
    className: className,
    style: style,
    ref: formRef,
    onSubmit: handleSubmit,
    "data-qa": "form"
  }, /*#__PURE__*/React.createElement(FormContext.Provider, {
    value: {
      provider: provider,
      fieldInstance: fieldInstance
    }
  }, children));
};

Form.defaultProps = {
  scrollOffset: 50,
  provider: FormProvider.Redux,
  fieldInstance: null
};
Form.propTypes = {
  /** Form field instance to pass */
  fieldInstance: PropTypes.oneOfType([PropTypes.shape(), PropTypes.func]),

  /** String - the form provider to render * */
  provider: PropTypes.oneOf(['redux', 'final']),

  /** Callback function to handle form submit */
  onSubmit: PropTypes.func.isRequired,

  /** Additional scrollOffset from top off the selected element */
  scrollOffset: PropTypes.number,

  /** Form child element to render */
  children: PropTypes.node.isRequired,

  /** Form root level additional class */
  className: PropTypes.string,

  /** Form root level additional style */
  style: PropTypes.shape()
};
export default Form;