import Resource from '@guestyci/agni';
import { API_REQUEST, apiError, apiSuccess } from "../actions/api"; // eslint-disable-next-line import/prefer-default-export

export var apiMiddleware = function apiMiddleware(_ref) {
  var dispatch = _ref.dispatch;
  return function (next) {
    return function (action) {
      next(action);

      if (action.type.includes(API_REQUEST)) {
        var _action$meta = action.meta,
            url = _action$meta.url,
            method = _action$meta.method,
            feature = _action$meta.feature;
        var body = action.payload;

        var _Resource$create = Resource.create(),
            api = _Resource$create.api;

        switch (method) {
          case 'GET':
            api.get(url, body).then(function (response) {
              return response.data;
            }).then(function (response) {
              return dispatch(apiSuccess({
                response: response,
                feature: feature
              }));
            })["catch"](function (error, response) {
              return dispatch(apiError({
                error: error,
                response: response,
                feature: feature
              }));
            });
            break;

          case 'DELETE':
            api["delete"](url).then(function (response) {
              return response.data;
            }).then(function (response) {
              return dispatch(apiSuccess({
                response: response,
                feature: feature
              }));
            })["catch"](function (error, response) {
              return dispatch(apiError({
                error: error,
                response: response,
                feature: feature
              }));
            });
            break;

          case 'POST':
            api.post(url, body).then(function (response) {
              return response.data;
            }).then(function (response) {
              return dispatch(apiSuccess({
                response: response,
                feature: feature
              }));
            })["catch"](function (error, response) {
              return dispatch(apiError({
                error: error,
                response: response,
                feature: feature
              }));
            });
            break;

          case 'PUT':
            api.put(url, body).then(function (response) {
              return response.data;
            }).then(function (response) {
              return dispatch(apiSuccess({
                response: response,
                feature: feature
              }));
            })["catch"](function (error, response) {
              return dispatch(apiError({
                error: error,
                response: response,
                feature: feature
              }));
            });
            break;

          case 'PATCH':
            api.patch(url, body).then(function (response) {
              return response.data;
            }).then(function (response) {
              return dispatch(apiSuccess({
                response: response,
                feature: feature
              }));
            })["catch"](function (error, response) {
              return dispatch(apiError({
                error: error,
                response: response,
                feature: feature
              }));
            });
            break;

          default:
            throw new Error('apiMiddleware - method is mandatory');
        }
      }
    };
  };
};