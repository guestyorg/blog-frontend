const axios = require('axios');

const DeployXYURL =
  'https://jenkinsci.guesty.com/job/IMDB-deploy-XY/buildWithParameters';

const api = ({ username, apiKey }) => {
  const conf = { auth: { username, password: apiKey } };
  const token = Buffer.from(`${username}:${apiKey}`, 'utf8').toString('base64');

  return {
    deployXY: async (...args) => deployXY(token, ...args),
  };
};

const deployXY = async (token, { x, y, branch, user, sha }) => {
  const url = `${DeployXYURL}?X=${x}&Y=${y}&branch=${branch}&user=${user}&sha=${sha}`;
  return axios.post(url, {}, { headers: { Authorization: `Basic ${token}` } });
};

module.exports = api;
