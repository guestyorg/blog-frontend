# Agni

Guesty's networking package.

<div align="center">
   <img src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Agni_18th_century_miniature.jpg"/>
</div>

## Features

- Dynamically create config file according to env from token
- Sniffing environment variable from the token
- Create axios http object with relevant configurations
- Allow for specific domain requests
- Add interceptors for 401 requests

## Installation

```sh
yarn add @guestyci/agni
```

## Example Usage

By default, Agni will create a resource pointing to the mailer url which is `api/v2`.

```javascript
import Resource from '@guestyci/agni';

const { api, env, config } = Resource.create();
api.get('/users').then(res => console.log(res)); // will go to `${config.MAILER_URL}/users`
console.log(env); // staging/production/staging5/preprod
```

You can also create an instance for a specific domain, which will go to the api gateway.

```javascript
const { api, env, config } = Resource.create('integrations');
api.get('/users').then(res => console.log(res)); // will go to `${config.API_GATEWAY}/integrations/users`
console.log(env); // staging (or other env identified from token)

const { api, env, config } = Resource.create('/integrations');
api.get('/users').then(res => console.log(res)); // will also go to `${config.API_GATEWAY}/integrations/users`
```

The last option is to go to the proxy route which is `/proxy`, using `createProxy`.

```javascript
const { api, env, config } = Resource.createProxy();
api.get('/users').then(res => console.log(res)); // will go to `${config.PROXY_URL}/
```

## Permissions

agni exports decoded permissions  

```javascript
const { api, env, config, roles } = Resource.create();
// roles  {"admin", "manager"}
roles.has('admin'); // true
```

The api object is an axios http object so you can read their documentation for furter reference - [axios](https://github.com/axios/axios).

## Full creation options

```javascript
{
    // env to force certain config
    env: 'preprod',

    // Token to force certain config without sniffing from local storage
    token: "afadg23413",

    // Append domain url to end of base url
    domain: "communications"
}
```

all other options you wish to configure the axios object needs to be passed as the axios documentation states.

```javascript
const { env } = Resource.create({ env: 'staging' });
console.log(env); // staging

const { config } = Resource.create('integrations');
console.log(config.baseURL); // https://..../integrations

const { config } = Resource.create({ domain: 'communications' });
console.log(config.baseURL); // https://..../communications

const { api } = Resource.create({ timeout: 4000, responseType: 'json' }); // api will have timeout and response type set
```
