"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateQueryFromMedia = generateQueryFromMedia;
exports["default"] = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = require("react");

var _useTheme = _interopRequireDefault(require("../useTheme"));

function camelToHyphen(str) {
  return str.replace(/[A-Z]/g, function (m) {
    return "-".concat(m.toLowerCase());
  });
}

function isDimention(feature) {
  return /[height|width]$/.test(feature);
}

function generateQueryFromMedia() {
  var media = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var breakpoints = arguments.length > 1 ? arguments[1] : undefined;
  var keys = Object.keys(media);
  var mediaQuery = '';
  keys.forEach(function (key, index) {
    var value = breakpoints[media[key]];
    var feature = camelToHyphen(key);

    if (isDimention(feature) && value) {
      value = "".concat(value, "px");
    }

    if (value === true) {
      mediaQuery += feature;
    } else if (value === false) {
      mediaQuery += "not ".concat(feature);
    } else {
      mediaQuery += "(".concat(feature, ": ").concat(value, ")");
    }

    if (index < keys.length - 1) {
      mediaQuery += ' and ';
    }
  });
  return mediaQuery;
}

function useMediaQuery() {
  var media = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var theme = (0, _useTheme["default"])();
  var supportMatchMedia = typeof window !== 'undefined' && typeof window.matchMedia !== 'undefined';
  var matchMedia = supportMatchMedia ? window.matchMedia : null;
  var query = (0, _react.useMemo)(function () {
    return generateQueryFromMedia(media, theme.breakpoints.values);
  }, [media]);

  var _useState = (0, _react.useState)(function () {
    if (matchMedia) {
      return matchMedia(query).matches;
    }

    return false;
  }),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isMatch = _useState2[0],
      setIsMatch = _useState2[1];

  (0, _react.useEffect)(function () {
    if (!matchMedia) {
      return;
    }

    var queryList = matchMedia(query);

    var handler = function handler() {
      setIsMatch(queryList.matches);
    };

    queryList.addListener(handler);
    return function () {
      return queryList.removeListener(handler);
    };
  }, [query]);
  return isMatch;
}

var _default = useMediaQuery;
exports["default"] = _default;