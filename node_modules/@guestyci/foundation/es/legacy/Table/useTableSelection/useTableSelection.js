import { useState, useEffect } from 'react';
import { getEmptySelection, getSelectionOnAction, getSelectionOnData } from "../tableUtility";
/**
 * Hook that provides table selection state
 * @param data {Array} - table data
 * @param rowIdDataKey {String} - key from row data to be used as identifier
 */

export default function useTableSelection({
  data = [],
  rowIdDataKey = '_id',
  itemsTotalCount
} = {}) {
  const [rowSelection, setSelection] = useState(getEmptySelection());

  const setTableSelection = action => {
    const nextSelection = getSelectionOnAction({
      rowSelection,
      action,
      data,
      rowIdDataKey,
      itemsTotalCount
    });
    setSelection(nextSelection);
  };

  const clearSelection = () => {
    setSelection(getEmptySelection());
  };

  useEffect(() => {
    const {
      allSelected
    } = rowSelection;

    if (allSelected) {
      const nextSelection = getSelectionOnData({
        rowSelection,
        data,
        rowIdDataKey
      });
      setSelection(nextSelection);
    }
  }, [data, rowIdDataKey]);
  return [rowSelection, setTableSelection, {
    clearSelection
  }];
}