# Platform-libs-localize

**Guesty's Localization helper**

ffff Check out the full localization docs [docs](https://rnd-docs.guesty.com/ui-infra/localization/overview/)

## Table of Contents

- [Installation](#installation)
- [Initialization](#initialization)
- [Actually getting translated strings](#translated-strings)
- [useTranslations Hook](#use-translations)
- [Adding new Strings](#new-translations)
- [Pluralization And Variables](#pluralization)
- [Getting translations up Fast (shortcut)](#short-way)
- [Misc](#misc)
- [CHANGELOG](#changelog)

<a name="installation"></a>

## Installation

yarn:

```bash
    yarn add @guestyci/localize
```

<a name="initialization"></a>

## Initializing project

To initialize your project, use the provided LocalizationProvider:

```javascript
import React from 'react';
import LocalizationProvider from '@guestyci/localize/LocalizationProvider';

const App = () => (
  <LocalizationProvider>
    <MyCoolRoute />
  </LocalizationProvider>
);

export default App;
```

The provider receives a `language` prop to force it's language. If not passed, default value will be read from local storage (so most of the time its ok to leave it empty).

<a name="translated-strings"></a>

## Actually getting translated strings

Currently there are three ways, that should be used according to the situation. In cases where its convinient to use the first method mentioned, please prefer it over the others (`useTranslations`). The options are:

1. `useTranslations` Hook.
2. `<FormattedMessage>` Component.
3. `intl.get` Function.

The first and second one are functions wrapping the `intl.get` function, which recieves two arguments. One is the `id` to identify it, and the other is the `defaultMessage` to be desplayed in case no translation is present.
Now we will go one by one explaining on the interface of each.

**Important**
We have a naming conventions for our keys that should be followed for the translator's sake. It uses a formation of:

```javascript
`${project file}:${flow1}.${flow2}.${flow3}.${string_meaning}
```

where all should be in snake_case.
For example:
`marketplace:listings.tripadvisor.modal.publish.error_heading`.

In case of less flows, just make it of the form:

```javascript
`${project file}:${flow1}.${string_meaning}
```

<a name="use-translations"></a>

## useTranslations Hook

There are multiple cases where one might want to use the hook.
The concept in all of them, is that the `ids` and `default messages` are passed as args, and the returning values are the translated strings.
The first argument for the the hook is an array containing either:

1. An `id` at the first location and a `defaultMessage` in the second location. (In case you are not familiar with the id and default message, please refet to the previous section).

### OR

2. An array of objects of the following form: `{ id: << Id >>, d: << d >>, variables: { <<vars>> } }` where `id` is the `id` mentioned above, `d` is the default message, and variables is an optional parameter in case of using dynamic variables. In case of dyamic arguments, an array of the variables can be passed as the second argument. Scroll down to the third use case for further reading.

Now we will go by the use cases one by one with examples:

1. Simple string:

   ```javascript
   import React from 'react';
   import useTranslations from '@guestyci/localize/useTranslations';

   const Component = () => {
     const [helloMessage] = useTranslations(['HELLO', 'Hello, bob']);

     return <div>{helloMessage}</div>;
   };
   export default Component;
   ```

2. Multiple strings:

   ```javascript
   import React from 'react';
   import useTranslations from '@guestyci/localize/useTranslations';

   const translations = [
     {
       id: 'ID_1',
       d: 'Default message one',
     },
     {
       id: 'ID_2',
       d: 'Default message 2',
     },
     {
       id: 'ID_3',
       d: 'Default message 3',
     },
   ];

   const Component = () => {
     const [first, second, third] = useTranslations(translations);
     return (
       <>
         <div>{first}</div>
         <div>{second}</div>
         <div>{third}</div>
       </>
     );
   };

   export default Component;
   ```

**PLEASE NOTICE**:
You can define the translations array below the component (as opposed to the example above) in order not to make the code harder to read since the first thing you will see is the translation object.

3. With variables:

   ```javascript
   import React from 'react';
   import useTranslations from '@guestyci/localize/useTranslations';

   const Component = ({ count }) => {
     const translations = [
       {
         id: 'id_1',
         d: 'Number of Pages {count}',
         variables: { count },
       },
     ];
     // the second argument is the dependency to track, similar to setState.
     const [translated] = useTranslations(translations, [count]);

     return <div>{translated}</div>;
   };

   export default Component;
   ```

<a name="new-translations"></a>

## Adding New Translated Strings and Strings to be translated

Other than the code, the actual translation process in guesty is seperated into 4 parts.

1. The strings are uploaded to a Firebase project called [Guesty-18n](https://console.firebase.google.com/u/0/project/guesty-18n/overview).
2. The strings are uploaded to crowdin from firebase. This happens every day at 3pm IST in the [CircleCI Project of localize](https://app.circleci.com/pipelines/github/guestyorg/localize).
3. The strings are translated in [Crowdin](https://crowdin.com/) by the translators.
4. The translations need to be updated in our S3 localization files. This also happens in the process described on stage 2.

Once all this happens, the translated strings should appear immediatly on all environments.

During this process, the stages that require developer involvements are only stage 1 most of the times. In case you really want to translate something fast there will be an exaplanation further down in a different section.

After you have used one of the methods of translating mentioned above (e.g `useTranslation`), in order to upload the strings to Firebase do the following steps:

- First, set the getLanguages=true as a url param.
  For example, change:
  `https://app.guesty.com`
  to
  `https://app.guesty.com/getLanguages=true`

You can check in the network tab in the chrome dev tools and see the network request that upload to firebase. After that, you wait for the other steps to be completed by other people.

### VERY IMPORTANT

The `getLanugages` flag will send every string that is **Rendered** to the firebase project, which means that if you want a string to be uploaded, you need to render it.

<a name="pluralization"></a>

## Plurilization And Variables

Due to a bug we have, pluralization and the use of variables may not work as expected.
What we mean by pluralization/variables is:

```javascript
intl.get(
  'Sent successfully to {num, plural, =1 {1 channel} other {# channels}'
);
```

When using this string using one of the methods mentioned above, the users will not see the correct translation, until the string is **translated** in english in the **en-US** language in crowdin. The translation should be exactly the value of the default value. See example for that in here:

https://crowdin.com/translate/dashboard-test/26/en-enus

in one of the strings that are pluralized/has variables.

<a name="short-way"></a>

## Advanced USE - Translate Really fast

In case you cant wait to 3pm IST, the translators are busy, or there is a blocker, you can speed up the upload process.

1. Upload to firebase using the same method as above.
2. Manually rerun the workflow that runs every day at 3pm from the CircleCI UI (There is a big button below the workflow title saying `Rerun`)
3. Now the strings should be in crowdin. Go there and translate them yourself in the language needed.
4. Rerun the job again (stage 2).

You should now see the strings translated in production.

<a name="misc"></a>

## MISC

All available functions in the API are under the root level `@guestyci/localize`
Other than what specifed, you can also find there components/functions:

- getLanguage
- FormattedMessage
- FormattedDate
- FormattedTime
- FormattedCurrency
- Moment
- withLocalization
- MomentFormatTypes

A list of all available component is available in our [storybook](http://livebook.guesty.com/localize)

<a name="changelog"></a>

## Changelog

For updates please refer to our [changelog](https://github.com/guestyorg/platform-fe-libs-localize/blob/master/CHANGELOG.md)
