import _extends from "@babel/runtime/helpers/esm/extends";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _toConsumableArray from "@babel/runtime/helpers/esm/toConsumableArray";
import React, { useContext, useMemo } from 'react';
import PropTypes from 'prop-types';
import cn from 'classnames';
import memoize from '@guestyci/memoize';
import InputLabel from "../InputLabel/InputLabel";
import FormFieldComponent from "./FormFieldComponent";
import { required as requiredFn } from "../../validators";
import { FormProvider } from "../../enums";
import FormContext from "../Form/FormContext";
var composeValidators = memoize(function (validators) {
  return function (value) {
    return validators.reduce(function (error, validator) {
      return error || validator(value);
    }, undefined);
  };
});
var buildValidators = memoize(function (validations, required) {
  return required ? [requiredFn].concat(_toConsumableArray(validations)) : validations;
});
export var getFormFieldValidation = function getFormFieldValidation(validations, required, provider) {
  return provider === FormProvider.Redux ? buildValidators(validations, required) : composeValidators(required ? [requiredFn].concat(_toConsumableArray(validations)) : validations);
};

var FormField = function FormField(_ref) {
  var children = _ref.children,
      label = _ref.label,
      tooltip = _ref.tooltip,
      className = _ref.className,
      style = _ref.style,
      name = _ref.name,
      validate = _ref.validate,
      field = _ref.field,
      fieldClassName = _ref.fieldClassName,
      inputLabelClassName = _ref.inputLabelClassName,
      required = _ref.required,
      props = _objectWithoutProperties(_ref, ["children", "label", "tooltip", "className", "style", "name", "validate", "field", "fieldClassName", "inputLabelClassName", "required"]);

  var _useContext = useContext(FormContext),
      provider = _useContext.provider,
      fieldInstance = _useContext.fieldInstance;

  var Field = field || fieldInstance;
  var validations = useMemo(function () {
    return getFormFieldValidation(validate, required, provider);
  }, [provider, validate, required]);
  return /*#__PURE__*/React.createElement("div", {
    className: cn('relative form-field w-fill', className),
    style: style,
    "data-qa": "form-field"
  }, label && /*#__PURE__*/React.createElement(InputLabel, {
    label: label,
    tooltip: tooltip,
    className: inputLabelClassName
  }), /*#__PURE__*/React.createElement(Field, _extends({
    name: name,
    validate: validations,
    className: fieldClassName,
    component: FormFieldComponent,
    required: required
  }, props), children));
};

FormField.defaultProps = {
  label: '',
  tooltip: '',
  className: '',
  field: undefined,
  style: {},
  fieldClassName: '',
  validate: [],
  required: false,
  inputLabelClassName: ''
};
FormField.propTypes = {
  /** form field name to validate accordingly */
  name: PropTypes.string.isRequired,

  /** the redux form field props - required due to redux-form limitations */
  field: PropTypes.oneOfType([PropTypes.shape(), PropTypes.func]),

  /** Form field level validations to run - to use required, use the boolean required prop - Must be an Array */
  validate: PropTypes.arrayOf(PropTypes.func),

  /** Form element to render */
  children: PropTypes.node.isRequired,

  /** form field label */
  label: PropTypes.string,

  /** Form field label tooltip */
  tooltip: PropTypes.oneOfType([PropTypes.node, PropTypes.string, PropTypes.arrayOf(PropTypes.node)]),

  /** Form field root level additional class */
  className: PropTypes.string,

  /** Form field root level additional class */
  style: PropTypes.shape(),

  /** Form field component level additional class */
  fieldClassName: PropTypes.string,

  /** Boolean indicator whether or not field is required */
  required: PropTypes.bool,

  /** Additional class for input label level */
  inputLabelClassName: PropTypes.string
};
export var FieldComponent = FormField;
export default FormField;