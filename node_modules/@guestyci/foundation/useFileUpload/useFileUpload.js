"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = require("react");

var _fileUploadUtility = require("../utils/fileUploadUtility");

var _constants = require("../constants/constants");

var _useScript3 = _interopRequireDefault(require("../useScript"));

var useFileUpload = function useFileUpload(_ref) {
  var onSuccess = _ref.onSuccess,
      onFailure = _ref.onFailure,
      rest = _ref.rest;
  var cloudinaryWidget = (0, _react.useRef)();

  var _useScript = (0, _useScript3["default"])(_constants.CLOUDINARY_URL),
      _useScript2 = (0, _slicedToArray2["default"])(_useScript, 2),
      loaded = _useScript2[0],
      error = _useScript2[1];

  (0, _react.useEffect)(function () {
    if (!cloudinaryWidget.current && loaded && !error && window.cloudinary) {
      cloudinaryWidget.current = (0, _fileUploadUtility.createUploadWidget)((0, _extends2["default"])({
        onSuccess: onSuccess,
        onFailure: onFailure
      }, rest));
    }

    if (error) {
      console.log('error', error);
    }
  }, [loaded, error, window.cloudinary]);

  var open = function open() {
    if (loaded && !error) {
      cloudinaryWidget.current.open();
    }
  };

  return [open];
};

var _default = useFileUpload;
exports["default"] = _default;