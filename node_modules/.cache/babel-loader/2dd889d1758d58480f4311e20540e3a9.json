{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.createProxy = exports.create = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _envUtils = require(\"./env-utils\");\n\nvar _permissions = require(\"./permissions\");\n\nvar _configs = require(\"./configs\");\n\nvar createConfig = function createConfig(env, isDevelopment) {\n  return (0, _extends2[\"default\"])({}, (0, _configs.airbnb)(env), (0, _configs.featureToggle)(env), (0, _configs.general)(env, isDevelopment), (0, _configs.overrides)(env));\n};\n\nvar defaultOptions = {\n  version: 'mailer',\n  domain: undefined,\n  isPublic: false\n};\n\nvar buildURL = function buildURL(_ref) {\n  var version = _ref.version,\n      domain = _ref.domain,\n      isPublic = _ref.isPublic,\n      config = _ref.config;\n\n  if (isPublic && !domain) {\n    console.warn('Error while creating Resource. No domain supplied to isPublic, reverting to api/v2');\n  }\n\n  var API_GATEWAY = config.API_GATEWAY,\n      API_GATEWAY_PUBLIC = config.API_GATEWAY_PUBLIC,\n      PROXY_URL = config.PROXY_URL,\n      MAILER_URL = config.MAILER_URL;\n\n  if (version === 'v3') {\n    var gateway = isPublic ? API_GATEWAY_PUBLIC : API_GATEWAY;\n\n    if (domain[0] === '/') {\n      return \"\".concat(gateway).concat(domain);\n    }\n\n    return \"\".concat(gateway, \"/\").concat(domain);\n  }\n\n  if (version === 'proxy') {\n    return PROXY_URL;\n  }\n\n  return MAILER_URL;\n};\n\nvar getVersion = function getVersion(options) {\n  var domain = options.domain;\n\n  if (typeof options === 'string' || domain) {\n    return 'v3';\n  }\n\n  return 'mailer';\n};\n\nvar baseURLForOptions = function baseURLForOptions(options) {\n  var baseURL = options.baseURL,\n      version = options.version,\n      domain = options.domain,\n      isPublic = options.isPublic,\n      config = options.config;\n  return baseURL || buildURL({\n    version: version,\n    domain: domain,\n    isPublic: isPublic,\n    config: config\n  });\n};\n\nvar create = function create() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultOptions;\n  var token = options.token || (0, _envUtils.getToken)();\n\n  var _parseToken = (0, _envUtils.parseToken)(token),\n      parsedEnv = _parseToken.parsedEnv,\n      userRoles = _parseToken.userRoles;\n\n  var env = options.env || parsedEnv || 'staging';\n  var version = options.version || getVersion(options);\n  var development = options.development || window.location.hostname === 'localhost';\n  var config = createConfig(env, development);\n  var urlOptions = typeof options === 'string' ? {\n    domain: options\n  } : options;\n  var baseURL = baseURLForOptions((0, _extends2[\"default\"])({}, urlOptions, {\n    config: config,\n    version: version,\n    env: env\n  }));\n\n  var http = _axios[\"default\"].create(options);\n\n  http.defaults.baseURL = baseURL; // adding CSRF header to all requests\n\n  http.defaults.headers.common['g-aid-cs'] = 'G-89C7E-9FB65-B6F69';\n  http.defaults.headers.common.Authorization = \"Bearer \".concat(token);\n  http.defaults.headers['post']['Content-Type'] = 'application/json';\n  http.defaults.headers['put']['Content-Type'] = 'application/json';\n  http.defaults.headers['patch']['Content-Type'] = 'application/json';\n\n  if (env === 'production') {\n    http.interceptors.response.use(function (response) {\n      return response;\n    }, function (error) {\n      var _error$response = error.response;\n      _error$response = _error$response === void 0 ? {} : _error$response;\n      var status = _error$response.status;\n      if (status === 401) window.location.replace('/auth/logout');\n      return Promise.reject(error);\n    });\n  }\n\n  var roles = (0, _permissions.createRoles)(userRoles);\n  return {\n    config: config,\n    env: env,\n    development: development,\n    version: version,\n    api: http,\n    roles: roles\n  };\n};\n\nexports.create = create;\n\nvar createProxy = function createProxy(options) {\n  var newOptions = (0, _extends2[\"default\"])({}, options, {\n    version: 'proxy'\n  });\n  return create(newOptions);\n};\n\nexports.createProxy = createProxy;\nvar _default = {\n  create: create,\n  createProxy: createProxy\n};\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/giladdekel/Workspace/Guesty/boilplate/simple-app/simple-app-archive/node_modules/@guestyci/agni/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","createProxy","create","_extends2","_axios","_envUtils","_permissions","_configs","createConfig","env","isDevelopment","airbnb","featureToggle","general","overrides","defaultOptions","version","domain","undefined","isPublic","buildURL","_ref","config","console","warn","API_GATEWAY","API_GATEWAY_PUBLIC","PROXY_URL","MAILER_URL","gateway","concat","getVersion","options","baseURLForOptions","baseURL","arguments","length","token","getToken","_parseToken","parseToken","parsedEnv","userRoles","development","window","location","hostname","urlOptions","http","defaults","headers","common","Authorization","interceptors","response","use","error","_error$response","status","replace","Promise","reject","roles","createRoles","api","newOptions","_default"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,8CAAD,CAApC;;AAEAC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAAC,SAAD,CAAP,GAAqBA,OAAO,CAACE,WAAR,GAAsBF,OAAO,CAACG,MAAR,GAAiB,KAAK,CAAjE;;AAEA,IAAIC,SAAS,GAAGR,sBAAsB,CAACC,OAAO,CAAC,gCAAD,CAAR,CAAtC;;AAEA,IAAIQ,MAAM,GAAGT,sBAAsB,CAACC,OAAO,CAAC,OAAD,CAAR,CAAnC;;AAEA,IAAIS,SAAS,GAAGT,OAAO,CAAC,aAAD,CAAvB;;AAEA,IAAIU,YAAY,GAAGV,OAAO,CAAC,eAAD,CAA1B;;AAEA,IAAIW,QAAQ,GAAGX,OAAO,CAAC,WAAD,CAAtB;;AAEA,IAAIY,YAAY,GAAG,SAASA,YAAT,CAAsBC,GAAtB,EAA2BC,aAA3B,EAA0C;AAC3D,SAAO,CAAC,GAAGP,SAAS,CAAC,SAAD,CAAb,EAA0B,EAA1B,EAA8B,CAAC,GAAGI,QAAQ,CAACI,MAAb,EAAqBF,GAArB,CAA9B,EAAyD,CAAC,GAAGF,QAAQ,CAACK,aAAb,EAA4BH,GAA5B,CAAzD,EAA2F,CAAC,GAAGF,QAAQ,CAACM,OAAb,EAAsBJ,GAAtB,EAA2BC,aAA3B,CAA3F,EAAsI,CAAC,GAAGH,QAAQ,CAACO,SAAb,EAAwBL,GAAxB,CAAtI,CAAP;AACD,CAFD;;AAIA,IAAIM,cAAc,GAAG;AACnBC,EAAAA,OAAO,EAAE,QADU;AAEnBC,EAAAA,MAAM,EAAEC,SAFW;AAGnBC,EAAAA,QAAQ,EAAE;AAHS,CAArB;;AAMA,IAAIC,QAAQ,GAAG,SAASA,QAAT,CAAkBC,IAAlB,EAAwB;AACrC,MAAIL,OAAO,GAAGK,IAAI,CAACL,OAAnB;AAAA,MACIC,MAAM,GAAGI,IAAI,CAACJ,MADlB;AAAA,MAEIE,QAAQ,GAAGE,IAAI,CAACF,QAFpB;AAAA,MAGIG,MAAM,GAAGD,IAAI,CAACC,MAHlB;;AAKA,MAAIH,QAAQ,IAAI,CAACF,MAAjB,EAAyB;AACvBM,IAAAA,OAAO,CAACC,IAAR,CAAa,oFAAb;AACD;;AAED,MAAIC,WAAW,GAAGH,MAAM,CAACG,WAAzB;AAAA,MACIC,kBAAkB,GAAGJ,MAAM,CAACI,kBADhC;AAAA,MAEIC,SAAS,GAAGL,MAAM,CAACK,SAFvB;AAAA,MAGIC,UAAU,GAAGN,MAAM,CAACM,UAHxB;;AAKA,MAAIZ,OAAO,KAAK,IAAhB,EAAsB;AACpB,QAAIa,OAAO,GAAGV,QAAQ,GAAGO,kBAAH,GAAwBD,WAA9C;;AAEA,QAAIR,MAAM,CAAC,CAAD,CAAN,KAAc,GAAlB,EAAuB;AACrB,aAAO,GAAGa,MAAH,CAAUD,OAAV,EAAmBC,MAAnB,CAA0Bb,MAA1B,CAAP;AACD;;AAED,WAAO,GAAGa,MAAH,CAAUD,OAAV,EAAmB,GAAnB,EAAwBC,MAAxB,CAA+Bb,MAA/B,CAAP;AACD;;AAED,MAAID,OAAO,KAAK,OAAhB,EAAyB;AACvB,WAAOW,SAAP;AACD;;AAED,SAAOC,UAAP;AACD,CA9BD;;AAgCA,IAAIG,UAAU,GAAG,SAASA,UAAT,CAAoBC,OAApB,EAA6B;AAC5C,MAAIf,MAAM,GAAGe,OAAO,CAACf,MAArB;;AAEA,MAAI,OAAOe,OAAP,KAAmB,QAAnB,IAA+Bf,MAAnC,EAA2C;AACzC,WAAO,IAAP;AACD;;AAED,SAAO,QAAP;AACD,CARD;;AAUA,IAAIgB,iBAAiB,GAAG,SAASA,iBAAT,CAA2BD,OAA3B,EAAoC;AAC1D,MAAIE,OAAO,GAAGF,OAAO,CAACE,OAAtB;AAAA,MACIlB,OAAO,GAAGgB,OAAO,CAAChB,OADtB;AAAA,MAEIC,MAAM,GAAGe,OAAO,CAACf,MAFrB;AAAA,MAGIE,QAAQ,GAAGa,OAAO,CAACb,QAHvB;AAAA,MAIIG,MAAM,GAAGU,OAAO,CAACV,MAJrB;AAKA,SAAOY,OAAO,IAAId,QAAQ,CAAC;AACzBJ,IAAAA,OAAO,EAAEA,OADgB;AAEzBC,IAAAA,MAAM,EAAEA,MAFiB;AAGzBE,IAAAA,QAAQ,EAAEA,QAHe;AAIzBG,IAAAA,MAAM,EAAEA;AAJiB,GAAD,CAA1B;AAMD,CAZD;;AAcA,IAAIpB,MAAM,GAAG,SAASA,MAAT,GAAkB;AAC7B,MAAI8B,OAAO,GAAGG,SAAS,CAACC,MAAV,GAAmB,CAAnB,IAAwBD,SAAS,CAAC,CAAD,CAAT,KAAiBjB,SAAzC,GAAqDiB,SAAS,CAAC,CAAD,CAA9D,GAAoEpB,cAAlF;AACA,MAAIsB,KAAK,GAAGL,OAAO,CAACK,KAAR,IAAiB,CAAC,GAAGhC,SAAS,CAACiC,QAAd,GAA7B;;AAEA,MAAIC,WAAW,GAAG,CAAC,GAAGlC,SAAS,CAACmC,UAAd,EAA0BH,KAA1B,CAAlB;AAAA,MACII,SAAS,GAAGF,WAAW,CAACE,SAD5B;AAAA,MAEIC,SAAS,GAAGH,WAAW,CAACG,SAF5B;;AAIA,MAAIjC,GAAG,GAAGuB,OAAO,CAACvB,GAAR,IAAegC,SAAf,IAA4B,SAAtC;AACA,MAAIzB,OAAO,GAAGgB,OAAO,CAAChB,OAAR,IAAmBe,UAAU,CAACC,OAAD,CAA3C;AACA,MAAIW,WAAW,GAAGX,OAAO,CAACW,WAAR,IAAuBC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,KAA6B,WAAtE;AACA,MAAIxB,MAAM,GAAGd,YAAY,CAACC,GAAD,EAAMkC,WAAN,CAAzB;AACA,MAAII,UAAU,GAAG,OAAOf,OAAP,KAAmB,QAAnB,GAA8B;AAC7Cf,IAAAA,MAAM,EAAEe;AADqC,GAA9B,GAEbA,OAFJ;AAGA,MAAIE,OAAO,GAAGD,iBAAiB,CAAC,CAAC,GAAG9B,SAAS,CAAC,SAAD,CAAb,EAA0B,EAA1B,EAA8B4C,UAA9B,EAA0C;AACxEzB,IAAAA,MAAM,EAAEA,MADgE;AAExEN,IAAAA,OAAO,EAAEA,OAF+D;AAGxEP,IAAAA,GAAG,EAAEA;AAHmE,GAA1C,CAAD,CAA/B;;AAMA,MAAIuC,IAAI,GAAG5C,MAAM,CAAC,SAAD,CAAN,CAAkBF,MAAlB,CAAyB8B,OAAzB,CAAX;;AAEAgB,EAAAA,IAAI,CAACC,QAAL,CAAcf,OAAd,GAAwBA,OAAxB,CAvB6B,CAuBI;;AAEjCc,EAAAA,IAAI,CAACC,QAAL,CAAcC,OAAd,CAAsBC,MAAtB,CAA6B,UAA7B,IAA2C,qBAA3C;AACAH,EAAAA,IAAI,CAACC,QAAL,CAAcC,OAAd,CAAsBC,MAAtB,CAA6BC,aAA7B,GAA6C,UAAUtB,MAAV,CAAiBO,KAAjB,CAA7C;AACAW,EAAAA,IAAI,CAACC,QAAL,CAAcC,OAAd,CAAsB,MAAtB,EAA8B,cAA9B,IAAgD,kBAAhD;AACAF,EAAAA,IAAI,CAACC,QAAL,CAAcC,OAAd,CAAsB,KAAtB,EAA6B,cAA7B,IAA+C,kBAA/C;AACAF,EAAAA,IAAI,CAACC,QAAL,CAAcC,OAAd,CAAsB,OAAtB,EAA+B,cAA/B,IAAiD,kBAAjD;;AAEA,MAAIzC,GAAG,KAAK,YAAZ,EAA0B;AACxBuC,IAAAA,IAAI,CAACK,YAAL,CAAkBC,QAAlB,CAA2BC,GAA3B,CAA+B,UAAUD,QAAV,EAAoB;AACjD,aAAOA,QAAP;AACD,KAFD,EAEG,UAAUE,KAAV,EAAiB;AAClB,UAAIC,eAAe,GAAGD,KAAK,CAACF,QAA5B;AACAG,MAAAA,eAAe,GAAGA,eAAe,KAAK,KAAK,CAAzB,GAA6B,EAA7B,GAAkCA,eAApD;AACA,UAAIC,MAAM,GAAGD,eAAe,CAACC,MAA7B;AACA,UAAIA,MAAM,KAAK,GAAf,EAAoBd,MAAM,CAACC,QAAP,CAAgBc,OAAhB,CAAwB,cAAxB;AACpB,aAAOC,OAAO,CAACC,MAAR,CAAeL,KAAf,CAAP;AACD,KARD;AASD;;AAED,MAAIM,KAAK,GAAG,CAAC,GAAGxD,YAAY,CAACyD,WAAjB,EAA8BrB,SAA9B,CAAZ;AACA,SAAO;AACLpB,IAAAA,MAAM,EAAEA,MADH;AAELb,IAAAA,GAAG,EAAEA,GAFA;AAGLkC,IAAAA,WAAW,EAAEA,WAHR;AAIL3B,IAAAA,OAAO,EAAEA,OAJJ;AAKLgD,IAAAA,GAAG,EAAEhB,IALA;AAMLc,IAAAA,KAAK,EAAEA;AANF,GAAP;AAQD,CApDD;;AAsDA/D,OAAO,CAACG,MAAR,GAAiBA,MAAjB;;AAEA,IAAID,WAAW,GAAG,SAASA,WAAT,CAAqB+B,OAArB,EAA8B;AAC9C,MAAIiC,UAAU,GAAG,CAAC,GAAG9D,SAAS,CAAC,SAAD,CAAb,EAA0B,EAA1B,EAA8B6B,OAA9B,EAAuC;AACtDhB,IAAAA,OAAO,EAAE;AAD6C,GAAvC,CAAjB;AAGA,SAAOd,MAAM,CAAC+D,UAAD,CAAb;AACD,CALD;;AAOAlE,OAAO,CAACE,WAAR,GAAsBA,WAAtB;AACA,IAAIiE,QAAQ,GAAG;AACbhE,EAAAA,MAAM,EAAEA,MADK;AAEbD,EAAAA,WAAW,EAAEA;AAFA,CAAf;AAIAF,OAAO,CAAC,SAAD,CAAP,GAAqBmE,QAArB","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = exports.createProxy = exports.create = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _envUtils = require(\"./env-utils\");\n\nvar _permissions = require(\"./permissions\");\n\nvar _configs = require(\"./configs\");\n\nvar createConfig = function createConfig(env, isDevelopment) {\n  return (0, _extends2[\"default\"])({}, (0, _configs.airbnb)(env), (0, _configs.featureToggle)(env), (0, _configs.general)(env, isDevelopment), (0, _configs.overrides)(env));\n};\n\nvar defaultOptions = {\n  version: 'mailer',\n  domain: undefined,\n  isPublic: false\n};\n\nvar buildURL = function buildURL(_ref) {\n  var version = _ref.version,\n      domain = _ref.domain,\n      isPublic = _ref.isPublic,\n      config = _ref.config;\n\n  if (isPublic && !domain) {\n    console.warn('Error while creating Resource. No domain supplied to isPublic, reverting to api/v2');\n  }\n\n  var API_GATEWAY = config.API_GATEWAY,\n      API_GATEWAY_PUBLIC = config.API_GATEWAY_PUBLIC,\n      PROXY_URL = config.PROXY_URL,\n      MAILER_URL = config.MAILER_URL;\n\n  if (version === 'v3') {\n    var gateway = isPublic ? API_GATEWAY_PUBLIC : API_GATEWAY;\n\n    if (domain[0] === '/') {\n      return \"\".concat(gateway).concat(domain);\n    }\n\n    return \"\".concat(gateway, \"/\").concat(domain);\n  }\n\n  if (version === 'proxy') {\n    return PROXY_URL;\n  }\n\n  return MAILER_URL;\n};\n\nvar getVersion = function getVersion(options) {\n  var domain = options.domain;\n\n  if (typeof options === 'string' || domain) {\n    return 'v3';\n  }\n\n  return 'mailer';\n};\n\nvar baseURLForOptions = function baseURLForOptions(options) {\n  var baseURL = options.baseURL,\n      version = options.version,\n      domain = options.domain,\n      isPublic = options.isPublic,\n      config = options.config;\n  return baseURL || buildURL({\n    version: version,\n    domain: domain,\n    isPublic: isPublic,\n    config: config\n  });\n};\n\nvar create = function create() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultOptions;\n  var token = options.token || (0, _envUtils.getToken)();\n\n  var _parseToken = (0, _envUtils.parseToken)(token),\n      parsedEnv = _parseToken.parsedEnv,\n      userRoles = _parseToken.userRoles;\n\n  var env = options.env || parsedEnv || 'staging';\n  var version = options.version || getVersion(options);\n  var development = options.development || window.location.hostname === 'localhost';\n  var config = createConfig(env, development);\n  var urlOptions = typeof options === 'string' ? {\n    domain: options\n  } : options;\n  var baseURL = baseURLForOptions((0, _extends2[\"default\"])({}, urlOptions, {\n    config: config,\n    version: version,\n    env: env\n  }));\n\n  var http = _axios[\"default\"].create(options);\n\n  http.defaults.baseURL = baseURL; // adding CSRF header to all requests\n\n  http.defaults.headers.common['g-aid-cs'] = 'G-89C7E-9FB65-B6F69';\n  http.defaults.headers.common.Authorization = \"Bearer \".concat(token);\n  http.defaults.headers['post']['Content-Type'] = 'application/json';\n  http.defaults.headers['put']['Content-Type'] = 'application/json';\n  http.defaults.headers['patch']['Content-Type'] = 'application/json';\n\n  if (env === 'production') {\n    http.interceptors.response.use(function (response) {\n      return response;\n    }, function (error) {\n      var _error$response = error.response;\n      _error$response = _error$response === void 0 ? {} : _error$response;\n      var status = _error$response.status;\n      if (status === 401) window.location.replace('/auth/logout');\n      return Promise.reject(error);\n    });\n  }\n\n  var roles = (0, _permissions.createRoles)(userRoles);\n  return {\n    config: config,\n    env: env,\n    development: development,\n    version: version,\n    api: http,\n    roles: roles\n  };\n};\n\nexports.create = create;\n\nvar createProxy = function createProxy(options) {\n  var newOptions = (0, _extends2[\"default\"])({}, options, {\n    version: 'proxy'\n  });\n  return create(newOptions);\n};\n\nexports.createProxy = createProxy;\nvar _default = {\n  create: create,\n  createProxy: createProxy\n};\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"script"}