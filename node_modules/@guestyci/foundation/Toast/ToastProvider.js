"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _createStyles = _interopRequireDefault(require("../createStyles"));

var _CSSTransitionGroup = _interopRequireDefault(require("../CSSTransitionGroup"));

var _Portal = _interopRequireDefault(require("../legacy/Portal"));

var _Layout = require("../Layout");

var _Toast = require("./Toast");

var _StackedToast = _interopRequireDefault(require("./StackedToast"));

var _context = _interopRequireDefault(require("./context"));

var _commonUtility = require("../utils/commonUtility");

var _zIndex = _interopRequireDefault(require("../theme/zIndex"));

var Provider = _context["default"].Provider;
var useStyles = (0, _createStyles["default"])(function (theme) {
  return {
    wrapper: {
      position: 'fixed',
      left: 'auto',
      right: 24,
      top: 24,
      zIndex: _zIndex["default"].toast
    },
    enter: {
      transition: theme.transition.create('transform'),
      transform: 'translate(100%)'
    },
    enterActive: {
      transform: 'translate(0%)',
      transition: theme.transition.create('transform')
    },
    exit: {
      transition: theme.transition.create('transform'),
      transform: 'scale(1.5)'
    },
    exitActive: {
      transform: 'scale(0)',
      transition: theme.transition.create('transform')
    }
  };
});

var ToastProvider = function ToastProvider(_ref) {
  var children = _ref.children,
      className = _ref.className,
      duration = _ref.duration;

  var _useStyles = useStyles(),
      wrapper = _useStyles.wrapper,
      rest = (0, _objectWithoutProperties2["default"])(_useStyles, ["wrapper"]);

  var _useState = (0, _react.useState)([]),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      toasts = _useState2[0],
      setToasts = _useState2[1];

  var dismissToast = (0, _react.useCallback)(function (id) {
    setToasts(function (_toasts) {
      return _toasts.filter(function (_toast) {
        return _toast.id !== id;
      });
    });
  }, [setToasts]);
  var ctx = (0, _react.useMemo)(function () {
    var addToast = _Toast.VARIANTS_NAMES.reduce(function (acc, variant) {
      acc[variant] = function (message) {
        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        var id = (0, _commonUtility.uuid)();
        var autoHide = options.autoHide,
            autoHideDelay = options.autoHideDelay,
            action = options.action;

        var onDismiss = function onDismiss() {
          return dismissToast(id);
        };

        setToasts(function (_toasts) {
          return [].concat((0, _toConsumableArray2["default"])(_toasts), [{
            autoHide: autoHide,
            autoHideDelay: autoHideDelay,
            action: action,
            variant: variant,
            message: message,
            id: id,
            onDismiss: onDismiss
          }]);
        });
        return onDismiss;
      };

      return acc;
    }, {});

    return {
      addToast: addToast
    };
  }, [setToasts, dismissToast]);
  return /*#__PURE__*/_react["default"].createElement(Provider, {
    value: ctx,
    "data-qa": "toast-provider"
  }, children, /*#__PURE__*/_react["default"].createElement(_Portal["default"], null, /*#__PURE__*/_react["default"].createElement(_Layout.Col, {
    spacing: 1,
    className: (0, _classnames["default"])(wrapper, className)
  }, /*#__PURE__*/_react["default"].createElement(_CSSTransitionGroup["default"], {
    animation: rest
  }, toasts === null || toasts === void 0 ? void 0 : toasts.map(function (props) {
    return /*#__PURE__*/_react["default"].createElement("div", {
      key: props.id
    }, /*#__PURE__*/_react["default"].createElement(_StackedToast["default"], (0, _extends2["default"])({}, props, {
      duration: duration
    })));
  })))));
};

ToastProvider.defaultProps = {
  duration: 300,
  className: ''
};
ToastProvider.propTypes = {
  /** Wrapper className */
  className: _propTypes["default"].string,

  /** App tree | Consumer target */
  children: _propTypes["default"].node.isRequired,

  /** Animation duration */
  duration: _propTypes["default"].number
};
var _default = ToastProvider;
exports["default"] = _default;