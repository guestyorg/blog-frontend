#!/usr/bin/env node

const ora = require('ora');

const { appendObjToPackageJson } = require('../util/files');
const { bootstrap } = require('../scripts/bootstrap');
const {
  BE: { baseImage, tags },
} = require('../util/default');

const spinner = ora({ spinner: 'triangle', color: 'blue' });

const start = async () => {
  try {
    spinner.start('Appending new scripts, please wait.');

    appendObjToPackageJson({
      guesty: {
        build: {
          baseImage,
          tags,
        },
      },
      husky: {
        hooks: {
          'pre-push': 'npx @guestyci/ebisu build-tags --byMessage',
        },
      },
    });

    spinner.succeed('New scripts added!');

    spinner.start('Start repo bootstrap');

    bootstrap('hydra');

    spinner.succeed('Finish repo bootstraping');
  } catch (e) {
    spinner.stop();
    throw e;
  }

  return;
};

module.exports = start;
