"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.scrollToFirstError = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _enums = require("../enums");

var _FormContext = _interopRequireDefault(require("./FormContext"));

var scrollToFirstError = function scrollToFirstError(offset) {
  var el = document.querySelector('.form-field-validation-error');

  if (!el) {
    return;
  }

  var _el$getBoundingClient = el.getBoundingClientRect(),
      top = _el$getBoundingClient.top;

  var scrollTop = document.documentElement.scrollTop;
  el.focus({
    preventScroll: true
  });
  window.scrollTo({
    top: top + scrollTop - offset,
    behavior: 'smooth'
  });
};

exports.scrollToFirstError = scrollToFirstError;

var Form = _react["default"].forwardRef(function Form(_ref, ref) {
  var onSubmit = _ref.onSubmit,
      children = _ref.children,
      className = _ref.className,
      style = _ref.style,
      provider = _ref.provider,
      fieldInstance = _ref.fieldInstance,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["onSubmit", "children", "className", "style", "provider", "fieldInstance"]);

  var handleSubmit = function handleSubmit(e) {
    scrollToFirstError(300);
    onSubmit(e);
  };

  return /*#__PURE__*/_react["default"].createElement("form", (0, _extends2["default"])({
    className: className,
    style: style,
    ref: ref,
    noValidate: true,
    onSubmit: handleSubmit
  }, props), /*#__PURE__*/_react["default"].createElement(_FormContext["default"].Provider, {
    value: {
      provider: provider,
      fieldInstance: fieldInstance
    }
  }, children));
});

Form.defaultProps = {
  provider: _enums.FormProvider.Final,
  fieldInstance: null
};
Form.propTypes = {
  /** Callback function to handle form submit */
  onSubmit: _propTypes["default"].func.isRequired,

  /** Form child element to render */
  children: _propTypes["default"].node.isRequired,

  /** Form field instance to pass */
  fieldInstance: _propTypes["default"].oneOfType([_propTypes["default"].shape(), _propTypes["default"].func]),

  /** String - the form provider to render * */
  provider: _propTypes["default"].oneOf(['redux', 'final']),

  /** Form root level additional class */
  className: _propTypes["default"].string,

  /** Form root level additional style */
  style: _propTypes["default"].shape()
};
Form.displayName = 'Form';
var _default = Form;
exports["default"] = _default;