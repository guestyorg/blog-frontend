"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.TimePickerComponent = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _moment = _interopRequireDefault(require("moment"));

var _MenuAutoPosition = _interopRequireDefault(require("../Menu/MenuAutoPosition"));

var _Menu = _interopRequireDefault(require("../Menu/Menu"));

var _ItemSelector = _interopRequireDefault(require("./ItemSelector"));

var _withCollapse = _interopRequireDefault(require("../Collapse/withCollapse"));

var _TimePickerInputField = _interopRequireDefault(require("./TimePickerInputField"));

var _ClickOutsideListener = _interopRequireDefault(require("../../ClickOutsideListener/ClickOutsideListener"));

function _createSuper(Derived) { return function () { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

var paddNumber = function paddNumber(num) {
  if (num < 10) {
    return "0".concat(num);
  }

  return num;
};

var HOURS12 = (0, _toConsumableArray2["default"])(Array(12).keys()).map(function (i) {
  return i + 1;
});
var MINUTES = (0, _toConsumableArray2["default"])(Array(60).keys());
var AMPM = ['AM', 'PM'];

var TimePicker = /*#__PURE__*/function (_PureComponent) {
  (0, _inherits2["default"])(TimePicker, _PureComponent);

  var _super = _createSuper(TimePicker);

  function TimePicker(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, TimePicker);
    _this = _super.call(this, props);

    _this.onChange = function () {
      var hours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : HOURS12[11];
      var minutes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : MINUTES[0];
      var ampm = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : AMPM[0];
      var _this$props = _this.props,
          id = _this$props.id,
          name = _this$props.name,
          onChange = _this$props.onChange;

      _this.setState({
        hours: hours,
        minutes: minutes,
        ampm: ampm
      }, function () {
        onChange(_this.getTimeStr(hours, minutes, ampm), id || name);
      });
    };

    _this.onHoursChange = function (hour) {
      var _this$state = _this.state,
          minutes = _this$state.minutes,
          ampm = _this$state.ampm;
      var hours = HOURS12[hour];

      _this.onChange(hours, minutes || MINUTES[0], ampm || AMPM[0]);
    };

    _this.onMinutesChange = function (minute) {
      var minutes = MINUTES[minute];
      var _this$state2 = _this.state,
          hours = _this$state2.hours,
          ampm = _this$state2.ampm;

      _this.onChange(hours || HOURS12[11], minutes, ampm || AMPM[0]);
    };

    _this.onAmpmChange = function (ampm) {
      var _this$state3 = _this.state,
          hours = _this$state3.hours,
          minutes = _this$state3.minutes;
      var _ampm = AMPM[ampm];

      _this.onChange(hours || HOURS12[11], minutes || MINUTES[0], _ampm);
    };

    _this.getHours = function (time) {
      var timeHour = time.hour();

      if (timeHour === 12 || timeHour === 0 && time.format('A') === 'AM') {
        return 12;
      }

      return time.hour() % 12;
    };

    _this.getTimeObj = function (timeStr) {
      if (!timeStr) {
        return {};
      }

      var time = (0, _moment["default"])(timeStr, 'hh:mm A');

      if (!time.isValid()) {
        time = (0, _moment["default"])("01-01-1970 ".concat(timeStr), 'MM-DD-YYYY hh:mm A');
      }

      return {
        hours: _this.getHours(time),
        minutes: time.minute(),
        ampm: time.format('A')
      };
    };

    _this.getTimeStr = function (h, m, ampm) {
      if (h === undefined || h === null) {
        return '';
      }

      return "".concat(paddNumber(h), ":").concat(paddNumber(m), " ").concat(ampm);
    };

    _this.clearTime = function () {
      _this.setState({
        hours: null,
        minutes: null,
        ampm: null
      });

      _this.onChange(null, null, null);
    };

    _this.reset = function () {
      var defaultValue = _this.props.defaultValue;

      var time = _this.getTimeObj(defaultValue);

      _this.setState((0, _extends2["default"])({}, time));

      _this.onChange(time.hours, time.minutes, time.ampm);
    };

    var initialValue = props.value || props.defaultValue;

    var _this$getTimeObj = _this.getTimeObj(initialValue),
        _hours = _this$getTimeObj.hours,
        _minutes = _this$getTimeObj.minutes,
        _ampm2 = _this$getTimeObj.ampm;

    _this.state = {
      minutes: _minutes,
      hours: _hours,
      ampm: _ampm2
    };
    return _this;
  }

  (0, _createClass2["default"])(TimePicker, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this$props2 = this.props,
          defaultValue = _this$props2.defaultValue,
          value = _this$props2.value;
      var _this$state4 = this.state,
          hours = _this$state4.hours,
          minutes = _this$state4.minutes,
          ampm = _this$state4.ampm;

      if (defaultValue || value) {
        this.onChange(hours, minutes, ampm);
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props3 = this.props,
          disabled = _this$props3.disabled,
          placeholder = _this$props3.placeholder,
          className = _this$props3.className,
          style = _this$props3.style,
          resetable = _this$props3.resetable,
          toggleCollapse = _this$props3.toggleCollapse,
          isCollapsed = _this$props3.isCollapsed,
          defaultValue = _this$props3.defaultValue,
          minutesStep = _this$props3.minutesStep,
          name = _this$props3.name,
          noClear = _this$props3.noClear,
          closeCollapse = _this$props3.closeCollapse,
          id = _this$props3.id;
      var _this$state5 = this.state,
          ampm = _this$state5.ampm,
          hours = _this$state5.hours,
          minutes = _this$state5.minutes;
      var hoursIndex = hours ? hours - 1 : 11;
      return /*#__PURE__*/_react["default"].createElement("div", {
        className: (0, _classnames["default"])('flex-end relative d-flex-fill', className),
        style: style,
        "data-qa": "time-picker"
      }, /*#__PURE__*/_react["default"].createElement(_TimePickerInputField["default"], {
        onClick: toggleCollapse,
        onClear: this.clearTime,
        onReset: this.reset,
        name: name,
        id: id,
        isOpen: !isCollapsed,
        resetable: resetable,
        defaultValue: defaultValue,
        disabled: disabled,
        placeholder: placeholder,
        value: this.getTimeStr(hours, minutes, ampm),
        noClear: noClear || resetable
      }), /*#__PURE__*/_react["default"].createElement(_MenuAutoPosition["default"], {
        trigger: !isCollapsed
      }, /*#__PURE__*/_react["default"].createElement(_ClickOutsideListener["default"], {
        onClickOutside: closeCollapse
      }, /*#__PURE__*/_react["default"].createElement(_Menu["default"], {
        className: "bg-white p-3 flex-center",
        collapse: isCollapsed,
        row: true,
        dense: true
      }, /*#__PURE__*/_react["default"].createElement(_ItemSelector["default"], {
        index: hoursIndex,
        values: HOURS12,
        onChange: this.onHoursChange,
        renderValue: paddNumber
      }), /*#__PURE__*/_react["default"].createElement(_ItemSelector["default"], {
        index: minutes,
        values: MINUTES,
        step: minutesStep,
        onChange: this.onMinutesChange,
        renderValue: paddNumber
      }), /*#__PURE__*/_react["default"].createElement(_ItemSelector["default"], {
        index: ampm === 'PM' ? 1 : 0,
        values: ['AM', 'PM'],
        onChange: this.onAmpmChange
      })))));
    }
  }]);
  return TimePicker;
}(_react.PureComponent);

TimePicker.defaultProps = {
  value: '',
  disabled: false,
  defaultValue: '',
  placeholder: 'Select',
  className: '',
  style: {},
  resetable: false,
  minutesStep: 1,
  showError: false,
  noClear: false,
  name: '',
  id: ''
};
TimePicker.propTypes = {
  /** Controlled value to be set - format 'hh:mm A' */
  value: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].number]),

  /** Indicator whether or not the input is disabled */
  disabled: _propTypes["default"].bool,

  /** CallBack for on value change */
  onChange: _propTypes["default"].func.isRequired,

  /** Callback function to be called on dropdown visibility change */
  onVisibilityChange: _propTypes["default"].func,

  /** Default value for input (also resets to value) - format 'hh:mm A' */
  defaultValue: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].number]),

  /** Placeholder for input level */
  placeholder: _propTypes["default"].string,

  /** Additional class for root level */
  className: _propTypes["default"].string,

  /** additional style for root level */
  style: _propTypes["default"].shape(),

  /** Show the reset option for the input (resets to defaultValue) */
  resetable: _propTypes["default"].bool,

  /** define the increacment/decreacment step on the minutes selector */
  minutesStep: _propTypes["default"].number,

  /** Show error icon */
  showError: _propTypes["default"].bool,

  /** Indicator whether or not we are disabling the clear button */
  noClear: _propTypes["default"].bool,

  /** Input level name */
  name: _propTypes["default"].string,

  /** Input level id */
  id: _propTypes["default"].string
};
var TimePickerComponent = TimePicker;
exports.TimePickerComponent = TimePickerComponent;

var _default = (0, _withCollapse["default"])(TimePicker);

exports["default"] = _default;