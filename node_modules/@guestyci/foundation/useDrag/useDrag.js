"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = require("react");

function useDrag(payload, onDrop) {
  var isDraggable = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  var dragRef = (0, _react.useRef)();

  var _useState = (0, _react.useState)(false),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isDragging = _useState2[0],
      setIsDragging = _useState2[1];

  var _useState3 = (0, _react.useState)(false),
      _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
      isDragOver = _useState4[0],
      setIsDragOver = _useState4[1];

  var handleDragStart = (0, _react.useCallback)(function (e) {
    e.stopPropagation();
    e.dataTransfer.setData('text', JSON.stringify(payload));
    e.dataTransfer.dropEffect = 'move';
    setIsDragging(true);
    setIsDragOver(false);
  }, [payload, setIsDragging, setIsDragOver]);
  var handleDragOver = (0, _react.useCallback)(function (e) {
    e.preventDefault();
    setIsDragOver(true);
  }, [setIsDragOver]);
  var handleDragDrop = (0, _react.useCallback)(function (e) {
    e.preventDefault();
    var data = JSON.parse(e.dataTransfer.getData('text'));
    setIsDragging(false);
    setIsDragOver(false);

    if (onDrop) {
      onDrop({
        sourceData: data,
        targetData: payload
      });
    }
  }, [payload, onDrop, setIsDragOver, setIsDragging]);
  (0, _react.useEffect)(function () {
    var node = dragRef.current;

    if (node && isDraggable) {
      node.draggable = true;
      node.addEventListener('dragstart', handleDragStart);
      node.addEventListener('drop', handleDragDrop);
      node.addEventListener('dragover', handleDragOver);
      return function () {
        node.draggable = false;
        node.removeEventListener('dragstart', handleDragStart);
        node.removeEventListener('drop', handleDragDrop);
        node.removeEventListener('dragover', handleDragOver);
      };
    }
  }, [payload, isDraggable, handleDragDrop, handleDragStart, handleDragOver]);
  return [{
    isDragging: isDragging,
    isDragOver: isDragOver
  }, dragRef];
}

var _default = useDrag;
exports["default"] = _default;