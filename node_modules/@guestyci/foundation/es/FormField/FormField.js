import _extends from "@babel/runtime/helpers/esm/extends";
import _objectWithoutPropertiesLoose from "@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";
import React, { useContext, useMemo } from 'react';
import PropTypes from 'prop-types';
import memoize from '@guestyci/memoize';
import FormFieldComponent from "./FormFieldComponent";
import { required as requiredFn } from "../validators";
import { FormProvider } from "../enums";
import FormContext from "../Form/FormContext";
const buildValidators = memoize((validations, required) => {
  return required ? [requiredFn, ...validations] : validations;
});
const composeValidators = memoize(validators => value => validators.reduce((error, validator) => error || validator(value), undefined));
export const getFormFieldValidation = (validations, required, provider) => provider === FormProvider.Redux ? buildValidators(validations, required) : composeValidators(required ? [requiredFn, ...validations] : validations);

const FormField = (_ref) => {
  let {
    name,
    label,
    info,
    children,
    className,
    style,
    validate,
    field,
    required
  } = _ref,
      props = _objectWithoutPropertiesLoose(_ref, ["name", "label", "info", "children", "className", "style", "validate", "field", "required"]);

  const {
    provider,
    fieldInstance
  } = useContext(FormContext);
  const Field = field || fieldInstance;
  const validations = useMemo(() => getFormFieldValidation(validate, required, provider), [provider, validate, required]);
  return /*#__PURE__*/React.createElement(Field, _extends({
    name: name,
    style: style,
    className: className,
    validate: validations,
    component: FormFieldComponent,
    required: required,
    label: label,
    info: info
  }, props, {
    "data-qa": "form-field"
  }), children);
};

FormField.defaultProps = {
  label: null,
  info: null,
  className: '',
  field: undefined,
  style: {},
  validate: [],
  required: false
};
FormField.propTypes = {
  /** form field name to validate accordingly */
  name: PropTypes.string.isRequired,

  /** the redux form field props - required due to redux-form limitations */
  field: PropTypes.oneOfType([PropTypes.shape(), PropTypes.func]),

  /** Form field level validations to run - to use required, use the boolean required prop - Must be an Array */
  validate: PropTypes.arrayOf(PropTypes.func),

  /** Form element to render */
  children: PropTypes.node.isRequired,

  /** form field label */
  label: PropTypes.string,

  /** form field Info description */
  info: PropTypes.string,

  /** Form field root level additional class */
  className: PropTypes.string,

  /** Form field root level additional class */
  style: PropTypes.shape(),

  /** Form field component level additional class */
  required: PropTypes.bool
};
export const FieldComponent = FormField;
export default FormField;