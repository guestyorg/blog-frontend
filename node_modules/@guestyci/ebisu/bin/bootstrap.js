#!/usr/bin/env node

const chalk = require('chalk');
const ora = require('ora');
const spinner = ora({ spinner: 'triangle', color: 'blue' });

const {
  bootstrap,
  jsonWithScripts,
  installDependencies,
} = require('../scripts/bootstrap');
const {
  getAppDir,
  getAppName,
  loadPackageJson,
  writePackageJson,
} = require('../util/files');

const start = async () => {
  try {
    const appDir = getAppDir();
    const appName = getAppName();

    bootstrap('app', appDir);

    const packageJson = loadPackageJson();
    const updatedPackageJson = jsonWithScripts(packageJson);

    writePackageJson(updatedPackageJson);

    spinner.start('Installing required dependencies, please be patient.');
    await installDependencies(updatedPackageJson);
    spinner.succeed(
      `Project bootstrapped successfully for ${chalk.bold.blue(appName)}.`
    );
  } catch (e) {
    spinner.stop();
    throw e;
  }
};

module.exports = start;
