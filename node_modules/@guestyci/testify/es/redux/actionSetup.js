import thunk from 'redux-thunk';
import configureMockStore from 'redux-mock-store';
import nock from 'nock';
import Resource from '@guestyci/agni';
import httpAdapter from 'axios/lib/adapters/http';
import "../testSetup";
const {
  api,
  config
} = Resource.create({
  env: 'development'
});
api.defaults.adapter = httpAdapter;
/**
 * Create the basic setup for redux action tests
 * @param middleware {Array} middleware array
 * @param serviceUrlKey {String}  Base service urlKey for api calls - As defined in the config file - Or an the service string,
 * @return {Object} {
 * store {Object} the store instance,
 * baseUrl {String} The base url defined
 * nock (Function) The nock function to call
 * }
 */

export default ((middleware = [thunk.withExtraArgument(api)], serviceUrlKey = 'API_URL') => store => {
  const mockStore = configureMockStore([...middleware]);
  const baseUrl = config[serviceUrlKey] || serviceUrlKey;
  return {
    store: mockStore(store),
    baseUrl,
    nock: nock(baseUrl)
  };
});